<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Video Recorder</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        display: flex;
        height: 100vh;
      }

      #left {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background-color: #f0f0f0;
        position: relative;
      }

      #right {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #ccc;
      }

      video {
        width: 100%;
        height: auto;
        border: 1px solid #ccc;
      }

      #cameraView {
        display: none;
      }

      #timeline {
        position: absolute;
        bottom: 20px;
        width: 100%;
        text-align: center;
        color: #333;
      }

      #startRecording,
      #stopRecording {
        padding: 10px 20px;
        font-size: 16px;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div id="left">
      <video id="cameraView" autoplay muted></video>
      <div id="timeline">Timeline here</div>
    </div>
    <div id="right">
      <button id="startRecording" onclick="startRecording()">
        Start Recording
      </button>
      <button id="stopRecording" onclick="stopRecording()">
        Stop Recording
      </button>
    </div>
    <script>
      const startRecordingButton = document.getElementById("startRecording");
      const stopRecordingButton = document.getElementById("stopRecording");
      const cameraView = document.getElementById("cameraView");
      const recordedVideo = document.createElement("video"); // Create a video element for recorded video
      let mediaRecorder;
      let chunks = [];

      async function startRecording() {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            video: true,
            audio: true,
          });
          cameraView.srcObject = stream;
          cameraView.style.display = "block";
          startRecordingButton.style.display = "none";
          mediaRecorder = new MediaRecorder(stream);
          mediaRecorder.ondataavailable = handleDataAvailable;
          mediaRecorder.start();
        } catch (error) {
          console.error("Error accessing media devices: ", error);
        }
      }

      function handleDataAvailable(event) {
        if (event.data.size > 0) {
          chunks.push(event.data);
        }
      }

      function stopRecording() {
        if (mediaRecorder && mediaRecorder.state === "recording") {
          mediaRecorder.stop();
          mediaRecorder.onstop = () => {
            const blob = new Blob(chunks, { type: "video/webm" });
            const url = URL.createObjectURL(blob);
            recordedVideo.src = url; // Set the recorded video as the source of the new video element
            recordedVideo.controls = true; // Enable controls for playback
            document.getElementById("left"); // Append the recorded video to the left container
            cameraView.style.display = "none";
            startRecordingButton.style.display = "inline-block";
            stopRecordingButton.style.display = "none";
            chunks = [];
            // Stop the camera stream
            const tracks = cameraView.srcObject.getTracks();
            tracks.forEach((track) => track.stop());
          };
        }
      }
    </script>
  </body>
</html>
