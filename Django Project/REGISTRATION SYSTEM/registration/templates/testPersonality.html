<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Video Recorder</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        display: flex;
        height: 100vh;
        color: #333;
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
      }

      #left,
      #right {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      #left {
        background-color: #080710;
      }

      #right {
        background-color: #0b340c;
        color: #fff;
      }

      video {
        width: 100%;
        height: auto;
        border: 1px solid #ccc;
        margin-bottom: 10px;
      }

      #cameraView {
        display: none;
      }

      #timeline {
        margin-top: auto;
        text-align: center;
      }

      h3,
      p {
        margin: 10px;
        text-align: center;
      }

      button {
        padding: 10px 20px;
        font-size: 16px;
        background-color: #333;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 10px;
      }

      button:hover {
        background-color: #555;
      }

      #stopRecording {
        display: none;
      }

      #recordedVideo {
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="left">
      <video id="cameraView" autoplay muted></video>
      <video id="recordedVideo" controls></video>
    </div>
    <div id="right">
      <h3>Video Recording</h3>
      <p>
        For your personality traits assessment, we need your video recording.
        You are requested to face the camera as if you are talking to your
        friends and give us a short introduction about yourself in
        <strong>15 seconds</strong>.
      </p>
      <button id="startRecording" onclick="startRecording()">
        Start Recording
      </button>
      <button id="stopRecording" onclick="stopRecording()">
        Stop Recording
      </button>
    </div>
    <script>
      const startRecordingButton = document.getElementById("startRecording");
      const stopRecordingButton = document.getElementById("stopRecording");
      const cameraView = document.getElementById("cameraView");
      const recordedVideo = document.getElementById("recordedVideo"); // Get the recorded video element
      let mediaRecorder;
      let chunks = [];

      async function startRecording() {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            video: true,
            audio: true,
          });
          cameraView.srcObject = stream;
          cameraView.style.display = "block";
          recordedVideo.style.display = "none";
          startRecordingButton.style.display = "none";
          stopRecordingButton.style.display = "inline-block"; // Display the stop button when recording starts
          mediaRecorder = new MediaRecorder(stream);
          mediaRecorder.ondataavailable = handleDataAvailable;
          mediaRecorder.start();
          // Automatically stop recording after 15 seconds
          setTimeout(stopRecording, 15000);
        } catch (error) {
          console.error("Error accessing media devices: ", error);
        }
      }

      function handleDataAvailable(event) {
        if (event.data.size > 0) {
          chunks.push(event.data);
        }
      }

      function stopRecording() {
        if (mediaRecorder && mediaRecorder.state === "recording") {
          mediaRecorder.stop();
          mediaRecorder.onstop = () => {
            const blob = new Blob(chunks, { type: "video/webm" });
            const url = URL.createObjectURL(blob);
            cameraView.src = url; // Set the recorded video as the source of the camera view
            cameraView.style.display = "block"; // Make the camera view visible again
            startRecordingButton.style.display = "inline-block";
            stopRecordingButton.style.display = "none"; // Hide the stop button when recording stops
            chunks = [];
            // Stop the camera stream
            const tracks = cameraView.srcObject.getTracks();
            tracks.forEach((track) => track.stop());

            // Play the recorded video
            recordedVideo.src = url;
            recordedVideo.controls = true;
            cameraView.style.display = "none";
            recordedVideo.style.display = "block";
          };
        }
      }
    </script>
  </body>
</html>
